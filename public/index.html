<!DOCTYPE html>
<html>
<head>
    <title>Goals With Friends</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" height="100%">
        <!-- everything vue manages goes here -->
        
        <div id="nav" v-if="display != displayLogin && display != displayRegister">
            <!-- navigation bar stuff -->
            <h1>Goals With Friends</h1>
            <a @click="goHome" style="cursor:pointer">Home</a>
            <a @click="goSocial" style="cursor:pointer">Find People</a>
            <a @click="goFollowing" style="cursor:pointer">Following</a>
            <a @click="goFollowers" style="cursor:pointer">Followers</a>
            <a @click="goGoals" style="cursor:pointer">Explore Goals</a>
            <a @click="logout" style="cursor:pointer">Logout</a>
        </div>
        
        <Transition>
        <div id="notifs" v-if="displayNotif">
            {{ notif }}
            <span style="float:right; cursor:pointer" @click="removeNotif()">&#10006</span>
        </div>
        </Transition>

        <div id="landing" v-if="display == displayLogin || display == displayRegister">
            <!-- everything login goes here -->   
            <div class="row">
            <div id="left">
                <!-- img id="landingImage" src="sample-background.jpg" -->
            </div>
            <div id="right">
                <h1>Goals With Friends</h1>
            <div class="centerBlock" v-show="display == displayLogin">
                <h2>Let's Get Started</h2>
                <div><input type="text" placeholder="email" v-model="userEmail"
                    minlength="1"
                    maxlength="30"></div>
                <div><input type="password" placeholder="password" v-model="userPassword"
                    minlength="1"
                    maxlength="30"></div>
                <div><button @click="login()">Log in</button></div>
                <hr style="width: 80%">
                <h3> Don't have an account? <a @click="goRegister()" style="cursor:pointer">Sign Up</a></h3>
            </div> 
           
            <div class="centerBlock" v-show="display == displayRegister"> 
                <h2>Let's Get Started</h2>
                <div><input type="text" placeholder="email" v-model="userEmail"
                    minlength="1"
                    maxlength="30"></div>
                <div><input type="text" placeholder="username" v-model="userUsername"
                    minlength="1"
                    maxlength="20"></div>
                <div>
                    <input style="width: 50%" type="text" placeholder="First" v-model="userFirst"
                    minlength="1"
                    maxlength="20"> 
                    <input style="width: 50%" type="text" placeholder="Last" v-model="userLast"
                    minlength="1"
                    maxlength="20">
                </div>
                <div><input type="password" placeholder="password" v-model="userPassword"
                    minlength="1"
                    maxlength="30"></div>
                <div><input type="password" placeholder="confirm password" v-model="confirmPassword"
                    minlength="1"
                    maxlength="30"></div>
                <div v-show="!(userPassword == confirmPassword)">*Passwords must match*</div>
                <div><button @click="register()">Sign Up</button></div>
                <hr style="width: 80%">
                <h3> Don't have an account? <a @click="goLogin()" style="cursor:pointer">Log In</a><h3>
                
            </div>
            </div>
            </div>
        </div>


        <div v-if="display == displayMain">
            <!-- everything on the main page goes here-->
            <a class="button" @click="goCreateGoal">Create a goal!</a>
            <input class="searchbar" type="text" placeholder="search goals" v-on:keyup="getUserGoalsFromServer(sessionID)" v-model="userGoalSearch">
            <a class="button" @click="goGoals">Explore other goals!</a>
            <div v-show="userGoals.length == 0">No goals found. Add some and they'll show up here!</div>
            <div v-for="pair, i in userGoals">
                <div class="column">
                    <div class="userGoal">
                        <span style="float:right; cursor:pointer" @click="removeUserGoalServer(pair.goal.goal_id)">&#10006</span>
                        <div @click="expandGoal(sessionID,pair.goal)" style="cursor:pointer"><h3> {{ pair.goal.title }} </h3></div>
                        <div><b> {{ pair.goal.description }} </b></div>
                        <table width="80%">
                            <tr>
                                <th v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"> {{ stat.weekday }} </th>
                            </tr>
                            <tr>
                                <th v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"> {{ stat.month + 1 }}/{{ stat.day }} </th>
                            </tr>
                            <tr>
                                <td v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"
                                    @click="toggleStat(stat,pair.goal)" 
                                    v-bind:style="{ color: stat.status == 1 ? '#0E9700' : '#FE0006'}"
                                    style="cursor:pointer; text-align:center">
                                    {{ stat.status == 1 ? '&#10004' : '&#10006' }}
                                </td>
                            </tr>
                        </table>
                        <div v-bind:style="{ color: (pair.goal.completeCount/7) >= (pair.goal.frequency/pair.goal.timeframe) ? '#0E9700' : '#FE0006'}"> target: {{ pair.goal.frequency }}/{{ pair.goal.timeframe }} days </div>
                    </div>
                </div>
            </div>
        </div>
       
        <div v-if="display == displaySingleGoalStats">
            <div class="fullGoal" v-for="pair in expandedGoals">
                <div><h2> {{ pair.goal.title }} </h2></div>
                <div><h3> {{ pair.goal.description }} </h3></div>
                <div><b> target: {{ pair.goal.frequency }}/{{ pair.goal.timeframe }} days </b></div>
                <template v-if="goalStats[pair.userID] != undefined">
                <table>
                    <tr>
                        <template v-for="i in 7">
                            <th v-if="goalStats[pair.userID][pair.goal.goal_id].weekday != undefined">{{ goalStats[pair.userID][pair.goal.goal_id][i-1].weekday }} </th>
                        </template>
                    </tr>
                    <template v-for="_, i in goalStats[pair.userID][pair.goal.goal_id]"
                        v-if="goalStats[pair.userID] != undefined">
                    <tr v-if="i % 7 == 0">
                        <template v-for="j in 7"> 
                        <td v-if="i + j <= goalStats[pair.userID][pair.goal.goal_id].length"
                            @click="toggleStat(goalStats[pair.userID][pair.goal.goal_id][i + j - 1],pair.goal)" 
                            style="cursor:pointer; text-align:center"
                            v-bind:style="{ backgroundColor: goalStats[pair.userID][pair.goal.goal_id][i + j - 1].status == 1 ? '#0E9700' : '#FE0006'}">
                            {{ goalStats[pair.userID][pair.goal.goal_id][i + j - 1].month + 1 }}/{{ goalStats[pair.userID][pair.goal.goal_id][i + j - 1].day }}
                        </td>
                        <td v-if="i+j==goalStats[pair.userID][pair.goal.goal_id].length && j != 0">
                            &larr; today
                        </td>
                        <td v-if="i+j-1>goalStats[pair.userID][pair.goal.goal_id].length">
                            
                        </td>
                        </template>
                        <td> 
                            interesting data goes here
                        </td>
                    </tr>
                    </template>
                </table>
                </template>
            </div>
            <span v-if="expandedGoals.length == 1">
                <h2 style="text-align:center">Compare against other users with same goal</h2>
                <div style="text-align:center; cursor:pointer" v-for="user in goalUsers[expandedGoals[0].goal.goal_id]" @click="expandGoal(user.user_id, expandedGoals[0])">
                    <h3 style="color:#015249">{{ user.username }}</h3>
                </div>
            </span>
        </div>

        <div v-if="display == displayOtherUserGoals">
            <h2>Now viewing {{ currentUser.first_name }} {{ currentUser.last_name}}'s goals</h2>
            <div v-for="pair, i in userGoals">
                <div class="column">
                    <div class="userGoal">
                        <div style="cursor:pointer"><b> {{ pair.goal.title }} </b></div>
                        <div> {{ pair.goal.description }} </div>
                        <table>
                            <tr>
                                <th v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"> {{ stat.weekday }} </th>
                            </tr>
                            <tr>
                                <th v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"> {{ stat.month + 1 }}/{{ stat.day }} </th>
                            </tr>
                            <tr>
                                <td v-for="stat in goalStats[pair.userID][pair.goal.goal_id]"
                                    v-bind:style="{ color: stat.status == 1 ? '#0E9700' : '#FE0006'}">
                                                                         <!-- '#0E9700' : '#FE0006' -->
                                    {{ stat.status == 1 ? '&#10004' : '&#10006' }}
                                </td>
                            </tr>
                        </table>
                        <div v-bind:style="{ color: (pair.goal.completeCount/7) >= (pair.goal.frequency/pair.goal.timeframe) ? '#0E9700' : '#FE0006'}"> target: {{ pair.goal.frequency }}/{{ pair.goal.timeframe }} days </div>
                    </div>
                </div>
            </div>
        </div>
        
        
        <div v-if="display == displaySingleGoalStats">
            <div v-for="stat, i in stats" @click="toggleStat()">
                <div> {{ stat.month }}/{{ stat.day }} </div>
                <div> {{ stat.status }} </div>
            </div> 
        </div>
        
        
        <div v-if="display == displaySocial">
            <!-- everything on the social page goes here-->
            <input class="searchbar" type="text" placeholder="search users" v-on:keyup="getUsersFromServer()" v-model="userSearch">
            <div style="text-align:center" v-show="users.length == 0"><h2>No users found</h2></div>
            <div class="user" v-for="user in users" v-show="user.user_id != sessionID">
                <div @click="expandUser(user)" style="cursor:pointer"><b> {{ user.username }} </b></div>
                <div @click="expandUser(user)" style="cursor:pointer"> {{ user.first_name }} {{ user.last_name }} </div>
                <div @click="expandUser(user)" style="cursor:pointer"> Similar goals: {{ user.count }} </div>
                <div style="margin-top:20px">
                    <a class="button" v-show="followingIDs.includes(user.user_id)" @click="unfollowUserOnServer(user)">Unfollow</a>
                    <a class="button" v-show="!followingIDs.includes(user.user_id)" @click="followUserOnServer(user)">Follow</a>
                </div>
            </div>
        </div>
    
        
        <div v-if="display == displayFollowing">
            <!-- everything on the social page goes here-->
            <div style="text-align:center" v-show="following.length == 0"><h2>No users found. Get Following!</h2></div>
            <div class="user" v-for="user in following" v-show="user.user_id != sessionID">
                <div @click="expandUser(user)" style="cursor:pointer"><b> {{ user.username }} </b></div>
                <div @click="expandUser(user)" style="cursor:pointer"> {{ user.first_name }} {{ user.last_name }} </div>
                <div style="margin-top:20px">
                    <a class="button" v-show="following.includes(user)" @click="unfollowUserOnServer(user)">Unfollow</a>
                    <a class="button" v-show="!(following.includes(user))" @click="followUserOnServer(user)">Follow</a>
                </div>
            </div>
        </div>
        
        <div v-if="display == displayFollowers">
            <!-- everything on the social page goes here-->
            <div style="text-align:center" v-show="followers.length == 0"><h2>No Followers Found</h2></div>
            <div class="user" v-for="user in followers" v-show="user.user_id != sessionID">
                <div @click="expandUser(user)" style="cursor:pointer"><b> {{ user.username }} </b></div>
                <div @click="expandUser(user)" style="cursor:pointer"> {{ user.first_name }} {{ user.last_name }} </div>
                <div style="margin-top:20px">
                    <a class="button" v-show="followingIDs.includes(user.user_id)" @click="unfollowUserOnServer(user)">Unfollow</a>
                    <a class="button" v-show="!(followingIDs.includes(user.user_id))" @click="followUserOnServer(user)">Follow Back</a>
                    <a class="button" v-show="followers.includes(user)" @click="removeFollowerOnServer(user)">Remove Follower</a>
                </div>
            </div>
        </div>


        <div v-if="display == displayGoals">
            <!-- everything on the goals page goes here-->
            <input class="searchbar" type="text" placeholder="search goals" v-on:keyup="getGoalsFromServer()" v-model="goalSearch">
            <div style="text-align:center" v-show="goals.length == 0"><h2>No goals found. Add some and they'll show up here!</h2></div>
            <div v-for="goal, i in goals">
                <div class="column" v-show="!(userGoalIDs.includes(goal.goal_id))">
                    <div class="goal">
                        <div><h3> {{ goal.title }} </h3></div>
                        <div> {{ goal.description }} </div>
                        <div> target: {{ goal.frequency }}/{{ goal.timeframe }} days </div>
                        <div style="margin-top:20px"> <a class="button" @click="addUserGoalServer(goal.goal_id)">Set Goal</a></div>
                        <h4>Users that you follow have this goal:</h4>
                        <template v-for="user, j in goalUsers[goal.goal_id]">
                        <div v-if="followingIDs.includes(user.user_id) && j < 2">
                            {{ user.username }}
                        </div>
                        <div v-if="j == 2">
                            ...
                        </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <div class="goalForm" v-show="display == displayCreateGoal">
            <!-- everything on the create goals page goes here-->
            <h2>Set a goal for yourself (and others!)</h2>
            <div><input type="text" placeholder="title your goal" v-model="goalTitle"
                minlength="1"
                maxlength="50"></div>
            <div><input type="text" placeholder="give a description of your goal" v-model="goalDescription"
                minlength="1"
                maxlength="50"></div>
            <div>How often will I do this goal?</div>
            <div>
                <input type="number" placeholder="2" style="width: 32px" v-model="goalFrequency"
                minlength="1"
                maxlength="3">
                of every
                <input type="number" placeholder="7" style="width: 32px" v-model="goalTimeframe"
                minlength="1"
                maxlength="3">
                days
                <div style="margin-top:10px"><a class="button" @click="createAndAddGoal()">Set Goal</a></div>
            </div>
        </div>
       

    </div>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="app.js"></script>
</body>
</html>
